## **CNPトレカ交流会LP 開発仕様書 v2.0**

### **1\. 概要**

本仕様書は、CNPトレカ交流会のためのWebアプリケーション開発に関する要件を定義するものです。アプリケーションは、**①一般ユーザー向けの交流会情報サイト**、**②イベント参加者向けのスタンプ獲得サイト**、そして**③管理者向けのイベント管理サイト**の3つの主要なコンポーネントで構成されます。

* **技術スタック（前提）**  
  * **ホスティング/インフラ**: **Railway**  
  * **データベース**: **PostgreSQL** (Railway上で構築)  
  * **フロントエンド/バックエンド**: **Next.js** または同等のフルスタックJavaScriptフレームワーク  
  * **認証**: **X (旧Twitter) OAuth 2.0**

### **2\. システム全体構成図**

各コンポーネントとデータベース、認証サービスの連携は以下の通りです。

graph TD  
    subgraph "👤 ユーザー / 管理者"  
        User\[一般ユーザー\]  
        Admin\[管理者\]  
    end

    subgraph "🌐 Webアプリケーション (Railway上でホスト)"  
        LP1\[LP①: 交流会情報サイト\]  
        LP2\[LP②: スタンプ獲得サイト\]  
        AdminPage\[③ 管理者ページ\]  
    end

    subgraph "⚙️ バックエンド (Railway)"  
        DB\[(🗃️ PostgreSQL DB)\]  
        X\_Auth\[🔐 X(Twitter)認証\]  
    end

    Admin \-- パスワード認証 \--\> AdminPage  
    AdminPage \-- CRUD操作 \--\> DB

    User \-- 閲覧 \--\> LP1  
    User \-- スタンプ確認(要X認証) \--\> LP1  
    LP1 \-- データ要求 \--\> DB  
    LP1 \-- 認証要求 \--\> X\_Auth

    User \-- QRコード等でアクセス \--\> LP2  
    LP2 \-- スタンプ獲得(要X認証) \--\> DB  
    LP2 \-- 認証要求 \--\> X\_Auth

    X\_Auth \-- ユーザー情報提供 \--\> LP1  
    X\_Auth \-- ユーザー情報提供 \--\> LP2

### **3\. データベース設計 (PostgreSQL)**

#### **3.1. Events テーブル**

* 交流会自体の情報を格納します。管理者ページからのみ操作されます。

| カラム名 | 型 | 説明 | 例 |
| :---- | :---- | :---- | :---- |
| id | UUID | **主キー**。自動生成される一意のID。 | a1b2c3d4-... |
| name | TEXT | イベント名 | 第3回 CNPトレカ東京交流会 |
| event\_date | DATE | 開催日 | 2025-09-15 |
| start\_time | TIME | 開始時刻 | 13:00:00 |
| area | TEXT | 地方エリア（絞り込み用） | 関東 |
| prefecture | TEXT | 都道府県 | 東京都 |
| venue\_name | TEXT | 会場名 | 渋谷ヒカリエ ホールA |
| address | TEXT | 会場住所 | 東京都渋谷区... |
| description | TEXT | イベント詳細、持ち物など | 初心者歓迎！... |
| created\_at | TIMESTAMPTZ | 作成日時（デフォルト: now()） | 2025-08-04... |

#### **3.2. Participants テーブル**

* どのユーザーがどのイベントに参加したか（スタンプを獲得したか）を記録します。

| カラム名 | 型 | 説明 |
| :---- | :---- | :---- |
| id | UUID | **主キー**。自動生成される一意のID。 |
| event\_id | UUID | **外部キー** (Events.id を参照)。 |
| user\_x\_id | TEXT | 参加者のXのユーザーID。 |
| user\_x\_name | TEXT | 参加者のXの表示名。 |
| user\_x\_icon\_url | TEXT | 参加者のXのアイコン画像URL。 |
| created\_at | TIMESTAMPTZ | スタンプ獲得日時（デフォルト: now()） |

**制約**:

* (event\_id, user\_x\_id) の組み合わせに対して **UNIQUE制約** を設定し、同一ユーザーが同一イベントに複数回登録されるのを防ぎます。

### **4\. アプリケーション機能仕様**

#### **4.1. LP①：交流会情報サイト（一般公開）**

* **目的**: ユーザーが全国のイベント情報を探し、自身の参加履歴を確認できるようにする。  
* **機能**:  
  1. **交流会カレンダー**: 月間カレンダーでイベント開催日を視覚的に表示。日付選択で該当日のイベントをリストアップ。  
  2. **全国エリア別スケジュール表**: エリア（関東、近畿など）でイベントを絞り込み、時系列で一覧表示。各イベントに「詳細を見る」ボタンを設置。  
  3. **交流会詳細ページ**: 「詳細を見る」から遷移。イベント詳細情報と、そのイベントの**参加メンバー一覧**（Xのアイコンと表示名）を表示。  
  4. **参加スタンプ確認（マイページ）**:  
     * ヘッダーのボタンからアクセス。  
     * **X認証が必須**。未認証の場合はログインを促す。  
     * 認証後、ログインユーザーがこれまでにスタンプを獲得したイベント履歴を一覧表示する。

#### **4.2. LP②：参加スタンプ獲得サイト（イベント会場用）**

* **目的**: イベント参加者がQRコードから簡単にアクセスし、参加の証（スタンプ）を即座に獲得できるようにする。  
* **アクセス**: 管理者が発行する、イベント固有のURL (https://\<ドメイン\>/stamp?event\_id=\<UUID\>) にアクセス。  
* **機能**:  
  1. ページにアクセスすると、URLからイベント名を特定し表示。  
  2. 「**Xで認証してスタンプをGET！**」ボタンを設置。  
  3. ボタンクリック後、X認証フローへ。  
  4. 認証成功後、バックエンドはevent\_idと認証されたユーザー情報をParticipantsテーブルに記録する。  
  5. **結果表示**:  
     * **成功時**: 「スタンプを獲得しました！」  
     * **重複時**: 「このイベントのスタンプは獲得済みです」  
     * **失敗時**: 「エラーが発生しました」

#### **4.3. ③：管理者ページ（非公開）**

* **目的**: 管理者が安全かつ簡単に交流会情報を管理できるようにする。  
* **アクセス**: 特定のURL（例: /admin）からアクセス。**パスワード認証**で保護する。  
* **機能**:  
  1. **イベント管理ダッシュボード**: 登録済みの全イベントを一覧表示。  
  2. **新規イベント登録**: Eventsテーブルに対応した入力フォームから新しいイベントを登録。idはDB側で自動生成。  
  3. **イベント編集・削除**: 既存のイベント情報を更新・削除する。  
  4. **スタンプ用URL発行**: イベント一覧の各項目に、対応する**LP②のURLをワンクリックでコピーできるボタン**を設置する。

### **5\. X認証フロー**

* **準備**: 管理者がXのデベロッパーアカウントで**アプリを1つ作成**し、発行される\*\*APIキー（Client ID, Client Secret）\*\*を取得。これらをRailwayの環境変数として安全に保管する。  
* **実行**: ユーザーがLP①（マイページ）またはLP②で認証ボタンを押すと、バックエンドに設定されたAPIキーを利用してXの認証ページへリダイレクトされる。ユーザーが許可すると、Xからユーザー情報（ID, 名前, アイコンURL）が払い出され、システムがこれをDBに保存したり、セッション管理に利用したりする。**参加者自身のAPIキーは一切不要**。